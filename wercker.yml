box: wercker/nodejs
build:
    steps:
        # We already have the modules inside the repository,
        # we just need to make sure that any native modules are ready for this env.
        - script:
            name: rebuild modules
            code: npm rebuild

        # Make sure our code passes the jshint command
        - script:
            name: jshint
            code: $(npm bin)/jshint

        # We're going to use reuse the node_modules for deployment, we will however
        # remove any dev dependencies.
        - script:
            name: npm prune
            code: npm prune --production

deploy:
    steps:
        - bundle-install
        - cap:
            stage: production
            tasks: deploy
